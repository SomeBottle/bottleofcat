# 关系数据库de关系代数小记

最近学数据库概论学到了**关系数据库**的关系代数了。哎嘛，真的把我整晕了，尤其是关系代数的使用，很容易让人被蒙在鼓里。  

![letmeunderstand-2021-10-06](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/letmeunderstand-2021-10-06.webp)

**对我来说**槽点最大的莫过于书上的例子不多了，本来就挺抽象的一种**查询**语言，加上没有足够多让我懂的例子<del>(不过我本来也比较迟钝了)</del>，真的是难上加难...  
但没办法啊，这是我需要跨过的一道坎，于是我决定慢慢写出这篇小记（**主要针对数据库关系代数**）。不求挖的多深，但求能理解地透彻点😂  
目标是...希望这篇文章对大家有所帮助吧！废话不多说，开整！  o(￣ヘ￣o＃)

* **注意，因采用了动图(WebP)直观表达，流量用户请慎重浏览~**

* **关系代数是一种查询语言。**

## 0x01 小概念  
<details>
<summary>展开阅读：行与列 , 目&度&元数 , 属性&字段 , 元组&基数&分量 , 域</summary>

--------

* ### **行与列**

    ![rowandcolumn-2021-10-06](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/rowandcolumn-2021-10-06.webp)

* ### **目** & **度** & **元数**  

    ![meshanddegree-2021-10-06](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/meshanddegree-2021-10-06.webp)  

    1.如果使用关系表进行展示的话，**属性数（字段数）**其实就是**列数**，而进一步我们将属性数称为**元数**或者**目**或者**度**。  

    2.这样看来其实**元数就是目，目也就是度**。  

* ### **属性** & **字段**  

    1.**属性**就是**字段**（至少在数据库关系表这里是这样），都表示的是**列**。  

    2.上面和下面的图中第一行 **学号,姓名,性别...** 等等是 **属性名（字段名）**。  

* ### **元组** & **基数** & **分量**

    ![tupleandcardinalityandcomponent-2021-10-06](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/tupleandcardinalityandcomponent-2021-10-06.webp)  

    1.表中的**一行**，是**一条记录**，也是**一个元组**，有n个元素的元组可以被称为**n元组**。  
    
    2.记录（元组）的数称为**基数**，一定一定注意辨别这里的基数和下面**域的基数**。  
    
    3.**分量**是元组中一个**属性对应的值**。  

* ### **域**  

    ![domain-2021-10-06](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/domain-2021-10-06.webp)  

    1.**域**就是属性的**取值范围所在**。  
    
    2.域是一个 **集合** ，域这个**集合**里的值都是**统一数据类型的**。  

    3.域也有一个**域的基数**，**域的基数**代表域能取的值的数量，比如： ```年龄属性的域={17,18,19,20,21,22,23,24,25}```，那么这个域的基数就是9  

    ![rememberfirst-2021-10-07](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/rememberfirst-2021-10-07.png)

</details>

## 0x02 传统的集合运算  

<details>
<summary>展开阅读：并/差/交的前提 , 并 , 差 , 交 , 广义笛卡尔积</summary>

--------

传统的集合运算是从 **行** 的角度来进行的，也就是说操作对象集中在**元组**上~(๑•̀ㅂ•́)و✧  

* ### **并,差,交的前提**

    ![union1-2021-10-06](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/union1-2021-10-06.webp)  

    1.运算要求两个关系**具有相同的目**(度,元数,属性数,列数)  
    2.运算要求两个关系**相应属性**取自**同一个域**，通俗来说，就是**两个关系对应的属性是相同的**  

* ### **并**  
    
    ![union2-2021-10-06](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/union2-2021-10-06.webp)

    因为是集合运算，并运算过程中**一定要记得元组去重**  

    返回的结果是 **n目(属性数)** 关系，由**属于R**或者**属于S**的**元组**组成  

* ### **差**  

    ![except1-2021-10-06](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/except1-2021-10-06.webp)  

    **R-S** 返回的结果是 **n目(属性数)** 关系，由**属于R**但**不属于S**的**元组**组成  

    一个例子可能有点模糊，接下来我们再来个 **S-R** 的例子：  

    ![except2-2021-10-07](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/except2-2021-10-07.webp)  

* ### **交**  

    ![intersection-2021-10-07](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/intersection-2021-10-07.webp)  

    **R∩S**返回的结果是 **n目(属性数)** 关系，由**属于R**且**属于S**的**元组**组成  

    很容易能发现：```R ∩ S = R - (R-S)```  

* ### **广义笛卡尔积**  

    ![bigiscoming-2021-10-07](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/bigiscoming-2021-10-07.png)  

    咱实话实说，关系代数这一部分第一个让我晕头的地方就是这个笛卡尔积o(≧口≦)o，接下来我尽力搞懂并用动图展示出来笛卡尔积到底做了什么。  

    为什么这里是 **广义笛卡尔积** 呢？我们先看 **笛卡尔积** 算了什么：  

    > 笛卡尔乘积是指在数学中，两个集合X和Y的笛卡尔积（Cartesian product），又称直积，表示为X×Y，第一个对象是X的成员而第二个对象是Y的所有可能有序对的其中一个成员 
    >> 摘自某百科  

    这个概念看得我脑袋嗡嗡的，什么叫 **“第二个对象是Y的所有可能有序对的其中一个成员”** ？结合例子琢磨了一会儿，我结合离散数学教材关于笛卡尔积的定义梳理了一下：  

    > 笛卡尔乘积是指在数学中，两个集合X和Y的笛卡尔积，又称直积，表示为X×Y。X中的元素作为第一个元素，Y中的元素作为第二个元素，构成有序对。而笛卡尔积就是所有这样的有序对构成的一个集合。  

    接下来我们回到这里，**域** 其实就是一个 **集合**，结合上文，**笛卡尔积是在域上面的一种\<集合\>运算** ，下面放个简单的例子：   

    ![cartesian1-2021-10-08](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/cartesian1-2021-10-08.webp)

    复习一下，一个 **域** 允许的 **不同取值的个数** 称为这个 **域的基数**。换种说法，也是一个 **集合** 中的 **元素个数**。  

    在上图的示例中，TEACHER域里有 ```张前程,赵向前``` 两位老师，这个域的基数也就是2；而MAJOR域里有 ```计算机专业,信息专业``` 两个专业，这个域的基数也是2。最后算出的域中有四个有序对，结果这个域的基数是4.  

    当 **域的基数为m和n** 的两个域进行笛卡尔积后我们得到的 **域** 的 **域的基数** 就是 **m×n** （这里×是乘号的意思哈，不要多想！ (￣△￣；)） 

    ![waitaminute-2021-10-08](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/waitaminute-2021-10-08.png)  

    仔细看一下能发现上面的例子中有个 **有序对** 的概念，不用怕，在关系这里我们后面就用不着它了！看看接下来这个例子：  

    ![cartesian2-2021-10-09](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/cartesian2-2021-10-09.webp)  

    到底其实我们算出了一个包含 **老师所带专业课程的所有可能性** 的集合（域），把每一项元素放进关系中，这不就是元组嘛！  

    -------
    ![guangyi-2021-10-09](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/guangyi-2021-10-09.png)  

    现在再说回 **广义笛卡尔积** ，为什么“广义”呢？因为它面向的是关系，通过 **操作元组** 进行运算。接下来我们快速上一个例子：  

    ![generalizedcartesian1-2021-10-10](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/generalizedcartesian1-2021-10-10.webp)

    > 两个分别为 **n目** 和 **m目** 的关系R和S的广义笛卡尔积是一个 **(n+m)列(目)** 的元组的集合(新关系)。元组的 **前n列** 是 **关系R** 的一个元组，**后m列** 是 **关系S** 的一个元组。若R有k1个元组，S有k2个元组，则关系R和关系S的广义笛卡尔积有 **k1 × k2** 个元组。  

    进行广义笛卡尔积时对两个关系的要求是比较宽松的：  

    1. **不要求** 两个关系的 **目(度,元数,属性数,列数)** 相同。  

    2. 有了上面这条，其实也应该知道了，广义笛卡尔积也 **不要求** 相应属性取自同一个域。

    在这之后我们再来个详细点的例子，把两张**不同**的表进行笛卡尔积：  

    ![generalizedcartesian2-2021-10-10](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/generalizedcartesian2-2021-10-10.webp)

    --------

    **总结**：

    1. 在数据库关系里，**笛卡尔积** 是面向 **域（集合）** ，操作元素来进行计算的；而 **广义笛卡尔积** 是面向 **关系** ，操作元组来进行计算的。  

    2. **随便两个关系** 都可以进行广义笛卡尔积运算（在保证 **结果的关系** 有意义的情况下）  

        ![doIlearnitbefore-2021-10-10](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/doIlearnitbefore-2021-10-10.png)  

至此，传统的集合运算这部分我们就过完了。你，学会了吗？喝杯茶休息一下，准备进入下一节吧！  

</details>

## 0x03 专门的关系运算   

<details open>
<summary>展开阅读：</summary>  

-----------------

专门的关系运算中就不仅涉及到 **行（元组）** 的运算了，还会牵扯到 **列**，由此会更加复杂。

我自己**可能也有理解错误**的地方，但我会尽力依据现有资料去呈现这些知识点。Sit back and relax，我们准备开始接下来的旅途！  

![v2-e8e7460c27f012d93794ca8b62ba727b_720w-2021-10-10](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/v2-e8e7460c27f012d93794ca8b62ba727b_720w-2021-10-10.jpg)  

* ### **基本运算符**  

    | 运算符   |    | 含义   |
    |:-----:|:---:|:----:|
    | 比较运算符 | ＞  | 大于   |
    |       | ≥  | 大于等于 |
    |       | ＜  | 小于   |
    |       | ≤  | 小于等于 |
    |       | =  | 等于   |
    |       | <> | 不等于  |
    | 逻辑运算符 | ┐  | 非    |
    |       | ∧  | 与(且) |
    |       | ∨  | 或    |

    基本运算符在后面的 **条件/逻辑表达式** 中经常用到。∧和∨这两个符号我觉得是最容易搞混的，着重记忆 (*￣3￣)╭  


* ### **选择**  

    选择是对 **行（元组）** 进行操作的运算。

    例子：属性名 = 常量  

    ![selection1.1-2021-10-10](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/selection1.1-2021-10-10.webp)  

    例子：属性名 θ 属性名  

    ![selection2-2021-10-10](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/selection2-2021-10-10.webp)

    
    * 选择语句形如 **σF(关系)** ，其中**F**是 **逻辑表达式** 。当遇到让逻辑表达式为 **真** 的 **元组** 时，该语句会将其选择出来。  

    * 逻辑表达式形如 **A θ B** ，也就是 **将A表达式和B表达式进行比较**，**θ** 是比较运算符。举几个例子：```StudentAge > 17``` , ```17 < StudentAge``` , ```CourseNum ≥ StudentNum``` , ```StudentName = 'Jerry'```。  

    * 上面的例子中```StudentAge``` , ```StudentName```一类是属性名，而```17``` , ```'Jerry'``` 一类则是常量。  

    * 所以A和B表达式可以是 **属性名** , **常量** , 书上还补充说可以是 **简单函数** ，不过在基础应用中不太能见得到。  

    * **多个** 逻辑表达式可以用 **逻辑运算符** 进行连接，举几个例子：```AθB ∧ CθD``` , ```AθB ∨ CθD``` , ```┐(AθB)```。

    大体来说，**选择** 选的是关系中符合条件的 **元组** ，得到的结果是 **元组集合（也算一个关系）**  

* ### **投影**  

    投影可以说是四种专门关系运算中最简单的一种了，我们可以简单走一遍~  

    投影是对 **列** 和少部分 **行** 进行操作的一种运算，我们先直接上例子：  

    ![projection-2021-10-11](https://cdn.jsdelivr.net/gh/cat-note/bottleassets@latest/img/projection-2021-10-11.webp)  

    * 投影语句形如 **ΠA(关系)** 其中 **A** 是属性名。  

    * 投影选出了 **特定属性名** 对应的 **列**。  

    * 投影选择出 **一列或多列** 属性列后，需要 **去除重复元组** ， 这也是为什么说投影涉及少部分行上的操作。  

* ### **除**  

    To be updated...


</details>




## 附表  

<details>
<summary>展开查看</summary>

* **0x01 小概念** 使用的表格：

    | 学号 | 姓名 | 性别 | 年龄 | 所在系 |
    |:--------:|:---:|:---:|:---:|:---:|
    | 20230102 | 新一 | 男  | 18 | CS  |
    | 20230103 | 高二 | 女  | 20 | CS  |
    | 20230104 | 张三 | 男  | 19 | MA  |
    | 20230105 | 李四 | 男  | 18 | IS  |
    | 20230106 | 王五 | 男  | 19 | CS  |
    | 20230107 | 赵六 | 女  | 21 | IS  |

* **0x02 传统的集合运算** 使用的表格  

    1. 前提,并,差  

        | 学号       | 姓名 | 性别 |   
        |:--------:|:---:|:---:|
        | 20230102 | 新一 | 男  |
        | 20230103 | 高二 | 女  |
        | 20230104 | 张三 | 男  |  

        | 学号       | 姓名 | 性别 |
        |:--------:|:---:|:---:|
        | 20230104 | 张三 | 男  |
        | 20230105 | 张三 | 女  |
        | 20230106 | 李四 | 男  |
        | 20230107 | 王五 | 男  |
        | 20230108 | 赵六 | 女  |

    2. 交  

        | 学号       | 姓名 | 性别 |
        |:--------:|:---:|:---:|
        | 20230102 | 新一 | 男  |
        | 20230103 | 高二 | 女  |
        | 20230104 | 张三 | 男  |

        | 学号       | 姓名 | 性别 |
        |:--------:|:---:|:---:|
        | 20230106 | 李四 | 男  |
        | 20230107 | 王五 | 男  |
        | 20230103 | 高二 | 女  |
        | 20230104 | 张三 | 男  |
        | 20230108 | 赵六 | 女  |

    3. 笛卡尔积  

        | 老师  | 课程所在专业 | 课程 |
        |:---:|:------:|:---:|
        | 张前程 | 计算机专业  | 高数 |
        | 张前程 | 计算机专业  | 离散 |
        | 张前程 | 计算机专业  | 线代 |
        | 张前程 | 信息专业   | 高数 |
        | 张前程 | 信息专业   | 离散 |
        | 张前程 | 信息专业   | 线代 |
        | 赵向前 | 计算机专业  | 高数 |
        | 赵向前 | 计算机专业  | 离散 |
        | 赵向前 | 计算机专业  | 线代 |
        | 赵向前 | 信息专业   | 高数 |
        | 赵向前 | 信息专业   | 离散 |
        | 赵向前 | 信息专业   | 线代 |

    4. 广义笛卡尔积  

        | A  | B  | C  |
        |:---:|:---:|:---:|
        | a1 | b1 | c1 |
        | a1 | b2 | c2 |

        | B  | C  | D  |
        |:---:|:---:|:---:|
        | b2 | c2 | d1 |
        | b3 | c2 | d3 |

        | 学号       | 姓名 | 性别 |
        |:--------:|:---:|:---:|
        | 20230102 | 新一 | 男  |
        | 20230103 | 高二 | 女  |

        | 课程名 | 课程号 |
        |:---:|:---:|
        | 高数  | 233 |
        | 离散  | 450 |
        | 线代  | 777 |

* **0x03 专门的关系运算** 使用的表格  

    1. 选择  

        示例一同 **0x01 小概念** 使用的表格，示例二如下：  

        | ID       | NAME | SEX | CREDIT | TARGET |
        |:--------:|:----:|:---:|:------:|:------:|
        | 20230102 | 新一   | 男   | 52     | 54     |
        | 20230103 | 高二   | 女   | 48     | 44     |
        | 20230104 | 张三   | 男   | 36     | 34     |
        | 20230105 | 李四   | 男   | 48     | 50     |
        | 20230106 | 王五   | 男   | 56     | 60     |
        | 20230107 | 赵六   | 女   | 42     | 60     |

    2. 投影  

        同 **选择** 的示例二表格



</details>


## 特别感谢
* [LemonPerfect](https://github.com/orgs/cat-note/people/LemonPrefect)  协助核对  
* [板砖猫](#) 协助核对  
* 动画番剧截图来自 [AnimeShot](https://as2.bitinn.net/)  

## References  
* 《数据库系统概论（第五版）》王珊主编 - 高等教育出版社  
* 《离散数学》屈婉玲,耿素云,张立昂 - 高等教育出版社
* [关系代数 - 百度百科](https://baike.baidu.com/item/%E5%85%B3%E7%B3%BB%E4%BB%A3%E6%95%B0)  
* [笛卡尔乘积 - 百度百科](https://baike.baidu.com/item/%E7%AC%9B%E5%8D%A1%E5%B0%94%E4%B9%98%E7%A7%AF)  
* [广义笛卡尔积 - 百度百科](https://baike.baidu.com/item/%E5%B9%BF%E4%B9%89%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF/23160124)  

